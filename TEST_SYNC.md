# 🔍 同步功能测试清单

## 测试目标
确保所有数据变动（添加、编辑、删除、设置更改）都能正确保存并同步到云端，且删除的记录不会再次出现。

---

## 📋 测试场景

### 场景 1：删除消费记录并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 添加至少 3 条消费记录（记录它们的 ID 或金额）
3. ✅ 删除其中一条记录
4. ✅ 点击"立即同步到云端"
5. ✅ 等待同步完成（查看控制台日志）
6. ✅ 完全关闭浏览器标签页
7. ✅ 重新打开应用
8. ✅ 验证：删除的记录不应再出现

**预期结果：**
- ✅ 控制台应显示：`✅ Successfully deleted X transactions from cloud`
- ✅ 重新打开后，删除的记录不应出现
- ✅ 其他记录应正常显示

---

### 场景 2：编辑消费记录并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 编辑一条现有消费记录（修改金额或备注）
3. ✅ 点击"立即同步到云端"
4. ✅ 完全关闭浏览器标签页
5. ✅ 重新打开应用
6. ✅ 验证：编辑后的记录应显示新内容

**预期结果：**
- ✅ 编辑后的数据应正确保存
- ✅ 重新打开后应显示编辑后的内容

---

### 场景 3：添加新消费记录并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 添加一条新消费记录
3. ✅ 点击"立即同步到云端"
4. ✅ 完全关闭浏览器标签页
5. ✅ 重新打开应用
6. ✅ 验证：新记录应正常显示

**预期结果：**
- ✅ 新记录应正确保存到云端
- ✅ 重新打开后应正常显示

---

### 场景 4：修改预算上限并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 进入设置页面
3. ✅ 修改预算上限（例如：从 30000 改为 50000）
4. ✅ 点击"立即同步到云端"
5. ✅ 完全关闭浏览器标签页
6. ✅ 重新打开应用
7. ✅ 验证：预算上限应为新值

**预期结果：**
- ✅ 预算上限应正确保存
- ✅ 重新打开后应显示新预算

---

### 场景 5：更改主题色并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 进入设置页面
3. ✅ 更改主题色（选择不同的主题）
4. ✅ 点击"立即同步到云端"
5. ✅ 完全关闭浏览器标签页
6. ✅ 重新打开应用
7. ✅ 验证：主题色应为新选择的主题

**预期结果：**
- ✅ 主题色应正确保存
- ✅ 重新打开后应显示新主题

---

### 场景 6：更改币值并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 进入设置页面
3. ✅ 更改币值（例如：从 TWD 改为 USD）
4. ✅ 点击"立即同步到云端"
5. ✅ 完全关闭浏览器标签页
6. ✅ 重新打开应用
7. ✅ 验证：币值应为新选择的币值

**预期结果：**
- ✅ 币值应正确保存
- ✅ 重新打开后应显示新币值

---

### 场景 7：添加分类并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 进入设置页面
3. ✅ 添加一个新分类
4. ✅ 点击"立即同步到云端"
5. ✅ 完全关闭浏览器标签页
6. ✅ 重新打开应用
7. ✅ 验证：新分类应正常显示

**预期结果：**
- ✅ 新分类应正确保存
- ✅ 重新打开后应正常显示

---

### 场景 8：删除分类并同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 进入设置页面
3. ✅ 删除一个分类（确保至少保留 1 个分类）
4. ✅ 点击"立即同步到云端"
5. ✅ 完全关闭浏览器标签页
6. ✅ 重新打开应用
7. ✅ 验证：删除的分类不应再出现

**预期结果：**
- ✅ 控制台应显示：`✅ Deleted X categories from cloud`
- ✅ 删除的分类不应再出现
- ✅ 其他分类应正常显示

---

### 场景 9：删除后未同步的情况

**测试步骤：**
1. ✅ 登录账户
2. ✅ 添加一条消费记录
3. ✅ 删除该记录
4. ✅ **不点击同步**，直接关闭浏览器
5. ✅ 重新打开应用
6. ✅ 验证：删除的记录应不再显示（本地删除已生效）

**预期结果：**
- ✅ 本地删除应立即生效
- ✅ 即使未同步，删除的记录也不应显示

---

### 场景 10：多个操作后同步

**测试步骤：**
1. ✅ 登录账户
2. ✅ 执行多个操作：
   - 添加 2 条新记录
   - 编辑 1 条现有记录
   - 删除 1 条记录
   - 修改预算
   - 更改主题
3. ✅ 点击"立即同步到云端"
4. ✅ 完全关闭浏览器标签页
5. ✅ 重新打开应用
6. ✅ 验证：所有更改都应正确保存

**预期结果：**
- ✅ 所有更改都应正确保存
- ✅ 重新打开后应显示所有更改

---

## 🔍 检查点

### 控制台日志检查

同步时，控制台应显示以下日志：

**成功同步：**
```
🔄 Starting sync to cloud...
✅ Synced X transactions
✅ Successfully deleted Y transactions from cloud (如果有删除)
✅ Synced X categories
✅ Deleted Y categories from cloud (如果有删除)
✅ Synced user settings
✅ Cleaned up Z old records from cloud
```

**从云端拉取：**
```
🔄 Pulling data from cloud...
✅ Pulled X transactions from cloud (Y updated, Z skipped - local is newer)
✅ Pulled X categories from cloud
✅ Pulled user settings from cloud (updated) 或 (local is newer)
```

---

## ⚠️ 常见问题排查

### 问题 1：删除后重新打开仍看到记录

**可能原因：**
- 同步未成功执行
- 云端删除失败

**解决方法：**
1. 检查控制台是否有错误
2. 确认已登录账户
3. 确认网络连接正常
4. 再次点击同步按钮

### 问题 2：编辑后重新打开显示旧数据

**可能原因：**
- 时间戳比较逻辑问题
- 本地数据未正确保存

**解决方法：**
1. 检查控制台日志
2. 确认 `updated_at` 字段正确设置
3. 检查 IndexedDB 中的数据

### 问题 3：设置更改未保存

**可能原因：**
- `save()` 函数未正确执行
- 同步未触发

**解决方法：**
1. 检查控制台是否有错误
2. 确认 `save()` 函数被调用
3. 手动点击同步按钮

---

## ✅ 测试完成标准

所有测试场景都应通过：
- ✅ 删除的记录不会再次出现
- ✅ 编辑的数据正确保存
- ✅ 添加的数据正常显示
- ✅ 所有设置更改正确保存
- ✅ 控制台无错误日志
- ✅ 同步操作成功完成

---

## 📝 测试记录

| 场景 | 测试日期 | 结果 | 备注 |
|------|---------|------|------|
| 场景 1 | | ⬜ | |
| 场景 2 | | ⬜ | |
| 场景 3 | | ⬜ | |
| 场景 4 | | ⬜ | |
| 场景 5 | | ⬜ | |
| 场景 6 | | ⬜ | |
| 场景 7 | | ⬜ | |
| 场景 8 | | ⬜ | |
| 场景 9 | | ⬜ | |
| 场景 10 | | ⬜ | |

---

**测试完成后，请在此文档中记录测试结果！**
