name: Keep Supabase Active

# æ¯å¤©å‡Œæ™¨ 2:00 UTC (å°ç£æ™‚é–“ 10:00) è‡ªå‹•åŸ·è¡Œ
on:
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨ 2:00 UTC
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Ping Supabase Database
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          echo "ğŸš€ Pinging Supabase to keep project active..."
          
          # ç™¼é€ç°¡å–®çš„æŸ¥è©¢è«‹æ±‚åˆ° categories è¡¨ï¼ˆåªæŸ¥è©¢ 1 ç­†ï¼‰
          response=$(curl -s -w "\n%{http_code}" \
            -X GET \
            "${SUPABASE_URL}/rest/v1/categories?select=id&limit=1" \
            -H "apikey: ${SUPABASE_ANON_KEY}" \
            -H "Authorization: Bearer ${SUPABASE_ANON_KEY}")
          
          # å–å¾— HTTP ç‹€æ…‹ç¢¼
          http_code=$(echo "$response" | tail -n1)
          
          # æª¢æŸ¥æ˜¯å¦æˆåŠŸ
          if [ "$http_code" -eq 200 ] || [ "$http_code" -eq 401 ]; then
            echo "âœ… Supabase ping successful! (HTTP $http_code)"
            echo "ğŸ“Š Response: $(echo "$response" | head -n -1)"
            exit 0
          else
            echo "âŒ Supabase ping failed! (HTTP $http_code)"
            echo "ğŸ“Š Response: $(echo "$response" | head -n -1)"
            exit 1
          fi

      - name: Log completion
        if: success()
        run: |
          echo "ğŸ‰ Supabase keep-alive completed at $(date)"
          echo "â° Next run: Tomorrow at 02:00 UTC"
