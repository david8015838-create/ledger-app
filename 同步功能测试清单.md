# 📋 同步功能测试清单

## 测试工具
已创建 `全面同步测试工具.html`，可以自动测试所有同步功能。

## 需要测试的功能

### ✅ 1. 币值切换 (Currency)
- **状态**: ✅ 已实现同步
- **数据库字段**: `user_settings.currency`
- **测试方法**: 
  1. 在主应用中切换币值（TWD/USD/SGD等）
  2. 点击"立即同步到云端"
  3. 使用测试工具验证 Supabase 中的数据

### ✅ 2. 主题色 (Theme & Custom Theme)
- **状态**: ✅ 已实现同步
- **数据库字段**: 
  - `user_settings.theme_id` (预设主题)
  - `user_settings.custom_theme` (自定义主题，JSONB)
- **测试方法**:
  1. 在主应用中切换主题或设置自定义主题色
  2. 点击"立即同步到云端"
  3. 使用测试工具验证

### ✅ 3. 信用卡 (Credit Cards)
- **状态**: ✅ 已实现同步
- **数据库表**: `credit_cards`
- **测试方法**:
  1. 在主应用中添加/编辑信用卡
  2. 点击"立即同步到云端"
  3. 使用测试工具验证

### ✅ 4. 每月预算 (Budget)
- **状态**: ✅ 已实现同步
- **数据库字段**: `user_settings.budget`
- **测试方法**:
  1. 在主应用中设置预算
  2. 点击"立即同步到云端"
  3. 使用测试工具验证

### ✅ 5. 每一笔消费 (Transactions)
- **状态**: ✅ 已实现同步
- **数据库表**: `transactions`
- **包含字段**: 
  - 基础字段：amount, date, note, category, icon, currency
  - 信用卡字段：payment_method, card_id, installments, interest_rate, billing_month
- **测试方法**:
  1. 在主应用中添加交易（现金/信用卡）
  2. 点击"立即同步到云端"
  3. 使用测试工具验证

### ✅ 6. 新增的分类项目 (Categories)
- **状态**: ✅ 已实现同步
- **数据库表**: `categories`
- **测试方法**:
  1. 在主应用中添加/编辑分类
  2. 点击"立即同步到云端"
  3. 使用测试工具验证

### ⚠️ 7. 每月固定开销 (Recurring Transactions)
- **状态**: ⚠️ 目前只存储在 localStorage，未同步到 Supabase
- **需要**: 创建数据库表并添加同步功能
- **建议**: 定期交易会生成实际交易记录，这些交易记录会同步，但定期交易模板本身需要单独同步

## 测试步骤

### 步骤 1: 使用测试工具
1. 打开 `全面同步测试工具.html`
2. 确保已登录（工具会自动检查）
3. 点击"运行所有测试"
4. 查看测试结果

### 步骤 2: 在主应用中测试
1. 打开主应用 (index.html)
2. 确保已登录
3. 修改各种设置和数据：
   - 设置预算
   - 切换币值
   - 切换主题/设置自定义主题
   - 添加信用卡
   - 添加交易
   - 添加分类
4. 点击"立即同步到云端"
5. 打开浏览器控制台（F12）查看同步日志
6. 使用测试工具验证数据是否已同步

### 步骤 3: 跨设备测试
1. 在设备 A 上修改数据并同步
2. 在设备 B 上登录并同步
3. 验证设备 B 上的数据是否与设备 A 一致

## 验证 Supabase 数据

### 方法 1: 使用测试工具
- 打开 `全面同步测试工具.html`
- 点击各个测试按钮
- 查看结果

### 方法 2: 在 Supabase Dashboard 中查看
1. 访问：https://supabase.com/dashboard/project/ndtkurowumazsgdotlxb
2. 进入 **Table Editor**
3. 查看各个表的数据：
   - `user_settings` - 用户设置（预算、币值、主题）
   - `credit_cards` - 信用卡
   - `transactions` - 交易记录
   - `categories` - 分类

### 方法 3: 使用 SQL 查询
在 Supabase SQL Editor 中执行：
```sql
-- 查看用户设置
SELECT * FROM user_settings WHERE user_id = 'your-user-id';

-- 查看信用卡
SELECT * FROM credit_cards WHERE user_id = 'your-user-id' AND is_deleted = false;

-- 查看交易记录
SELECT * FROM transactions WHERE user_id = 'your-user-id' ORDER BY date DESC LIMIT 10;

-- 查看分类
SELECT * FROM categories WHERE user_id = 'your-user-id';
```

## 已知问题

1. **定期交易未同步**: 定期交易模板只存储在 localStorage，未同步到 Supabase
   - 影响：跨设备使用时，定期交易模板不会同步
   - 解决方案：需要创建 `recurring_transactions` 表并添加同步功能

2. **BIGINT 错误已修复**: 交易 ID 现在确保是整数

## 下一步

如果需要同步定期交易，需要：
1. 创建 `recurring_transactions` 表
2. 在 `syncToCloud()` 中添加定期交易同步
3. 在 `syncFromCloud()` 中添加定期交易拉取
